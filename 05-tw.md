NIP-05 中文譯文
==============

Nostr 欄位與 DNS 網路名稱的對照
---------------------------

`最終版` `可選項` `作者:fiatjaf` `作者:mikedilger`

第 `0` 類也就是 `set_metadata` 事件內容可以有 `"nip05"` 欄位，用 [internet identifier](https://datatracker.ietf.org/doc/html/rfc5322#section-3.4.1) email 風格的文字值。但即使所謂 "internet identifier"，NIP-05 只接受本地名稱由不分大小寫的 `a-z0-9-_.` 等符號構成。

客戶端一見到 `"nip05"` 欄位，會將它拆開為本地名稱與領域名稱二個段落。於是，可用 HTTP GET 請求 `https://「領域名稱」/.well-known/nostr.json?name=「本地名稱」`.

其結果須是一份 JSON 文件，裡頭 `"names"` 欄位須是 16 進制數字的 pubkey 的對應名字，寫成字串。如果該名字對得到 `set_metadata` 事件裡的欄位 `pubkey` ，客戶端會總結所給的 pubkey 可對照到 `"nip05"` 網路名稱。

### 例子

如果客戶端看到如下事件：

```json
{
  "pubkey": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9",
  "kind": 0,
  "content": "{\"name\": \"bob\", \"nip05\": \"bob@example.com\"}"
  ...
}
```

它會 GET `https://example.com/.well-known/nostr.json?name=bob` 並獲得下列結果

```json
{
  "names": {
    "bob": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9"
  }
}
````

或者，可能多帶一個 `"relays"` 欄位：

```json
{
  "names": {
    "bob": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9"
  },
  "relays": {
    "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9": [ "wss://relay.example.com", "wss://relay2.example.com" ]
  }
}
````

只要 pubkey 能對照後來如上所述結果的 `"names"` 欄位，則對應成立，並且 `"nip05"` 欄位值有效並適合呈現。

可選用的 `"relays"` 欄位裡，可以有個欄位名稱為 pubkey 值，而欄位值為一列中繼站址。只要有 `"relays"` 欄位，就能幫客戶端多知道一些中繼站。有些網頁伺服器可已根據查詢條件而提供不同的 `/.well-known/nostr.json` 檔案，它也須在同一則回覆查詢裡，盡可能提供該網路名稱的中繼站址。

## Finding users from their NIP-05 identifier

A client may implement support for finding users' public keys from _internet identifiers_, the flow is the same as above, but reversed: first the client fetches the _well-known_ URL and from there it gets the public key of the user, then it tries to fetch the kind `0` event for that user and check if it has a matching `"nip05"`.

## Notes

### Clients must always follow public keys, not NIP-05 addresses

For example, if after finding that `bob@bob.com` has the public key `abc...def`, the user clicks a button to follow that profile, the client must keep a primary reference to `abc...def`, not `bob@bob.com`. If, for any reason, the address `https://bob.com/.well-known/nostr.json?name=bob` starts returning the public key `1d2...e3f` at any time in the future, the client must not replace `abc...def` in his list of followed profiles for the user (but it should stop displaying "bob@bob.com" for that user, as that will have become an invalid `"nip05"` property).

### Public keys must be in hex format

Keys must be returned in hex format. Keys in NIP-19 `npub` format are are only meant to be used for display in client UIs, not in this NIP.

### User Discovery implementation suggestion

A client can also use this to allow users to search other profiles. If a client has a search box or something like that, a user may be able to type "bob@example.com" there and the client would recognize that and do the proper queries to obtain a pubkey and suggest that to the user.

### Showing just the domain as an identifier

Clients may treat the identifier `_@domain` as the "root" identifier, and choose to display it as just the `<domain>`. For example, if Bob owns `bob.com`, he may not want an identifier like `bob@bob.com` as that is redundant. Instead, Bob can use the identifier `_@bob.com` and expect Nostr clients to show and treat that as just `bob.com` for all purposes.

### Reasoning for the `/.well-known/nostr.json?name=<local-part>` format

By adding the `<local-part>` as a query string instead of as part of the path the protocol can support both dynamic servers that can generate JSON on-demand and static servers with a JSON file in it that may contain multiple names.

### Allowing access from JavaScript apps

JavaScript Nostr apps may be restricted by browser [CORS][] policies that prevent them from accessing `/.well-known/nostr.json` on the user's domain. When CORS prevents JS from loading a resource, the JS program sees it as a network failure identical to the resource not existing, so it is not possible for a pure-JS app to tell the user for certain that the failure was caused by a CORS issue. JS Nostr apps that see network failures requesting `/.well-known/nostr.json` files may want to recommend to users that they check the CORS policy of their servers, e.g.:

```bash
$ curl -sI https://example.com/.well-known/nostr.json?name=bob | grep -i ^Access-Control
Access-Control-Allow-Origin: *
```

Users should ensure that their `/.well-known/nostr.json` is served with the HTTP header `Access-Control-Allow-Origin: *` to ensure it can be validated by pure JS apps running in modern browsers.

[CORS]: https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS

### Security Constraints

The `/.well-known/nostr.json` endpoint MUST NOT return any HTTP redirects.

Fetchers MUST ignore any HTTP redirects given by the `/.well-known/nostr.json` endpoint.
