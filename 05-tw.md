NIP-05 中文譯文
==============

Nostr 欄位與 DNS 網路名稱的對照
---------------------------

`最終版` `可選項` `作者:fiatjaf` `作者:mikedilger`

第 `0` 類也就是 `set_metadata` 事件內容可以有 `"nip05"` 欄位，用 [internet identifier](https://datatracker.ietf.org/doc/html/rfc5322#section-3.4.1) email 風格的文字值。但即使所謂 "internet identifier"，NIP-05 只接受本地名稱由不分大小寫的 `a-z0-9-_.` 等符號構成。

客戶端一見到 `"nip05"` 欄位，會將它拆開為本地名稱與領域名稱二個段落。於是，可用 HTTP GET 請求 `https://「領域名稱」/.well-known/nostr.json?name=「在地名稱」`.

其結果須是一份 JSON 文件，裡頭 `"names"` 欄位須是 16 進制數字的 pubkey 的對應名字，寫成字串。如果該名字對得到 `set_metadata` 事件裡的欄位 `pubkey` ，客戶端會總結所給的 pubkey 可對照到 `"nip05"` 網路名稱。

### 例子

如果客戶端看到如下事件：

```json
{
  "pubkey": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9",
  "kind": 0,
  "content": "{\"name\": \"bob\", \"nip05\": \"bob@example.com\"}"
  ...
}
```

它會 GET `https://example.com/.well-known/nostr.json?name=bob` 並獲得下列結果

```json
{
  "names": {
    "bob": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9"
  }
}
````

或者，可能多帶一個 `"relays"` 欄位：

```json
{
  "names": {
    "bob": "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9"
  },
  "relays": {
    "b0635d6a9851d3aed0cd6c495b282167acf761729078d975fc341b22650b07b9": [ "wss://relay.example.com", "wss://relay2.example.com" ]
  }
}
````

只要 pubkey 能對照後來如上所述結果的 `"names"` 欄位，則對應成立，並且 `"nip05"` 欄位值有效並適合呈現。

可選用的 `"relays"` 欄位裡，可以有個欄位名稱為 pubkey 值，而欄位值為一列中繼站址。只要有 `"relays"` 欄位，就能幫客戶端多知道一些中繼站。有些網頁伺服器可已根據查詢條件而提供不同的 `/.well-known/nostr.json` 檔案，它也須在同一則回覆查詢裡，盡可能提供該網路名稱的中繼站址。

## 藉由 NIP-05 名稱找人

客戶端可以用 _internet identifiers_ 實作使用者 pubkey 的搜尋比對，流程如以上所述的倒反：首先客戶端取得已知的網址，並由其中可知使用者的公鑰，接著，客戶端試著索取 `0` 事件類型，然後比對看是否符合 `"nip05"` 值。

## 說明

### 客戶端要朝著個人資料的 pubkey 追蹤；不能藉由 NIP-05 標示的地址追蹤對方

例如，假設找到 `bob@bob.com` 的公鑰是 `abc...def`，使用者按下一個按鈕可以追蹤個人資訊，則客戶端須就著 `abc...def` 追蹤，而不是由 `bob@bob.com` 追蹤他。如果網址 `https://bob.com/.well-known/nostr.json?name=bob` 因故改提供另一把公鑰 `1d2...e3f` ，客戶端可不能將原本追蹤對象的公鑰 `abc...def` 換成另一把公鑰 `1d2...e3f`；而客戶端只會認為 "bob@bob.com" 不代表這一位追蹤對象，因為 `"nip05"` 的證明無效。

### 公鑰須以 16 進制數字呈現

公鑰都是以 16 進制數字取得。在 NIP-19 的 `npub` 格式只用來在客戶端的使用者介面上呈現，但在本文 NIP-05 不一樣。

### 個人資料發覺的實作建議

客戶端也可以讓人用 `"nip05"` 來找其他個人資料。如果客戶端提供了搜尋欄位，使用者可以敲 "bob@example.com" 進輸入欄位，客戶端收到之後，做適當的處理，取出 pubkey 而回覆建議給使用者。

### 只顯示領域名稱為識別

客戶端可以將網路名稱用 `_@「領域名稱」` 方式表達領域名稱裡頭的主名稱 ("root")，而要顯示的時候，則只顯示領域名稱。例如，如果 Bob 擁有 `bob.com`，他可能不想要把名字寫成 `bob@bob.com`。則他可以讓名字是 `_@bob.com`，並希望 Nostr 客戶端為一般用途幫他顯示 `bob.com` 為他的名字。

### `/.well-known/nostr.json?name=「在地名稱」` 格式的處理

動態網站與靜態網站，都藉由查詢字串 `name=「在地名稱」` 得到結果。動態網站可以依照參數而生成特定的 JSON 檔案。靜態網站則可能是一個 JSON 檔案內給了很多 `"names"`。

### 容許 JavaScript 前端

JavaScript Nostr 前端能限於瀏覽器的[跨域資源分享 (CORS)][] 原則，阻擋其去個人資料所在領域取得 `/.well-known/nostr.json`。當發生這種事之後， JavaScript 程式會判定其為網路錯誤，同時認為沒有該項資源。因此，我們無法藉由純 JavaScript 應用軟體向操作人回報那是有關於跨域資源分享的障礙。您可以向使用者建議以下列指令確認伺服器的跨域資源分享原則：

```bash
$ curl -sI https://example.com/.well-known/nostr.json?name=bob | grep -i ^Access-Control
Access-Control-Allow-Origin: *
```

使用者須確定他們提供 `/.well-known/nostr.json` 的伺服器已配置 HTTP 標頭 `Access-Control-Allow-Origin: *`，使當代瀏覽器的 JavaScript 應用軟體能檢驗該特徵。

[跨域資源分享 (CORS)]: https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS

### 安全條件

`/.well-known/nostr.json` 網站端點須不處理任何 HTTP 轉送。

當客戶端索取 `/.well-known/nostr.json` 檔案時，須忽略任何 HTTP 轉送結果。
